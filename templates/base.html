<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Ledger System{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/css/tom-select.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        /* Tom Select Dark Mode/Theme Adjustments if needed */
        .ts-control {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 8px;
        }
        .ts-wrapper.single .ts-control {
            box-shadow: none;
            background-image: none;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                <h1>BDJ Ledger</h1>
                <span style="color:#fff; opacity:0.9; font-weight: bold; font-size: 1.3rem;">Model: {{ session.model_name or 'None' }}</span>
                
                <div class="font-controls" style="display: flex; gap: 5px;">
                    <button onclick="changeFontSize(1)" title="Increase Font" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.4); border-radius: 4px; padding: 2px 8px; font-weight: bold; cursor: pointer; font-size: 1.1rem;">A+</button>
                    <button onclick="changeFontSize(-1)" title="Decrease Font" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.4); border-radius: 4px; padding: 2px 8px; font-weight: bold; cursor: pointer; font-size: 1.1rem;">A-</button>
                </div>
            </div>

            <button class="menu-toggle" id="menuToggle" aria-label="Toggle menu">â˜°</button>
            <ul class="nav-menu" id="navMenu">
                <li><a href="{{ url_for('index') }}">Home</a></li>
                <li><a href="{{ url_for('transactions') }}">Transactions</a></li>
                {% if session.permissions and session.permissions.can_view_clients %}
                <li><a href="{{ url_for('clients') }}">Clients</a></li>
                {% endif %}
                <li><a href="{{ url_for('countries') }}">Countries</a></li>
                {% if not session.username %}
                <li><a href="{{ url_for('login') }}">Login</a></li>
                {% endif %}
            </ul>
        </div>
    </nav>
    
    <main class="container">
        {% if error %}
        <div class="alert alert-error">{{ error }}</div>
        {% endif %}
        {% if message %}
        <div class="alert alert-success">{{ message }}</div>
        {% endif %}
        
        {% block content %}{% endblock %}
    </main>
    
    <footer>
        <div class="container" style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap;">
            <p>&copy; 2024 Ledger System. All rights reserved.</p>
            <ul class="nav-menu" style="display:flex; gap:10px; list-style:none; margin:0; padding:0;">
                {% if session.permissions and session.permissions.is_admin %}
                <li><a href="{{ url_for('models') }}">Models</a></li>
                <li><a href="{{ url_for('wallet_view') }}">Wallet</a></li>
                <li><a href="{{ url_for('list_users') }}">Users</a></li>
                {% endif %}
                {% if session.username %}
                <li><a href="{{ url_for('change_password') }}">Change Password</a></li>
                <li><a href="{{ url_for('logout') }}">Logout ({{ session.username }})</a></li>
                {% endif %}
            </ul>
        </div>
    </footer>
    
    <script src="{{ url_for('static', filename='main.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/js/tom-select.complete.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        // Font size control
        function changeFontSize(direction) {
            const html = document.documentElement;
            const style = window.getComputedStyle(html, null).getPropertyValue('font-size');
            let currentSize = parseFloat(style);
            
            // Default 16px if not set
            if (!currentSize) currentSize = 16;
            
            if (direction === 1) {
                currentSize += 1;
            } else {
                currentSize -= 1;
            }
            
            // Limits (12px to 24px)
            if (currentSize < 12) currentSize = 12;
            if (currentSize > 24) currentSize = 24;
            
            html.style.fontSize = currentSize + 'px';
            localStorage.setItem('preferred-font-size', currentSize);
        }

        // Apply saved font size on load
        (function() {
            const savedSize = localStorage.getItem('preferred-font-size');
            if (savedSize) {
                document.documentElement.style.fontSize = savedSize + 'px';
            }
        })();

        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('select').forEach(function(el) {
                if (el.tomselect) return;
                new TomSelect(el, {
                    create: false,
                    sortField: {
                        field: "text",
                        direction: "asc"
                    }
                });
            });
        });
    </script>
    <script>
        // Mobile menu toggle
        const menuToggle = document.getElementById('menuToggle');
        const navMenu = document.getElementById('navMenu');
        
        if (menuToggle && navMenu) {
            menuToggle.addEventListener('click', function() {
                navMenu.classList.toggle('active');
            });
            
            // Close menu when clicking outside
            document.addEventListener('click', function(event) {
                if (window.innerWidth <= 768) {
                    if (!event.target.closest('.navbar')) {
                        navMenu.classList.remove('active');
                    }
                }
            });
        }
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var main = document.querySelector('main.container');
            var navMenuEl = document.getElementById('navMenu');
            if (main) {
                main.style.opacity = '0';
                main.style.transition = 'opacity 150ms ease-in';
                requestAnimationFrame(function() { main.style.opacity = '1'; });
            }
            if (navMenuEl) {
                var links = navMenuEl.querySelectorAll('a');
                var path = window.location.pathname;
                links.forEach(function(link) {
                    try {
                        var linkPath = new URL(link.href, window.location.origin).pathname;
                        if (linkPath === path) {
                            link.classList.add('active');
                        }
                        link.addEventListener('click', function(e) {
                            if (main) {
                                e.preventDefault();
                                navMenuEl.classList.remove('active');
                                main.style.opacity = '0';
                                setTimeout(function() { window.location.href = link.href; }, 120);
                            }
                        });
                    } catch (_) {}
                });
            }
        });
    </script>
</body>
</html>

