{% extends "base.html" %}

{% block title %}Clients - Ledger System{% endblock %}

{% block content %}
<div class="page-header">
    <h2>Clients</h2>
    <a href="{{ url_for('add_client') }}" class="btn btn-primary">Add New Client</a>
</div>

{% if clients %}
<!-- Desktop Table View -->
<div class="table-container">
    <table class="data-table">
        <thead>
            <tr>
                <th>S.No</th>
                <!-- <th>ID</th> -->
                <th>Client Name</th>
                <th>â˜</th>
                <th>Balance</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for client in clients %}
            <tr>
                <td>{{ loop.index }}</td>
                <!-- <td>{{ client.id }}</td> -->
                <td>{{ client.client_name }}</td>
                <td>{{ client.phone_number }}</td>
                <td><strong>{{ (client.balance or 0)|comma2 }}</strong></td>
                <td>
                    <a href="{{ url_for('edit_client', client_id=client.id) }}" class="btn btn-secondary btn-sm">Edit</a>
                    <button class="btn btn-success btn-sm" onclick="updateBalance('{{ client.id }}', 'credit')">Credit</button>
                    <button class="btn btn-warning btn-sm" onclick="updateBalance('{{ client.id }}', 'debit')">Debit</button>
                    <a href="{{ url_for('balance_history', client_id=client.id) }}" class="btn btn-info btn-sm">ğŸ—’ï¸</a>
                    <a href="{{ url_for('client_transactions', client_id=client.id) }}" class="btn btn-primary btn-sm">ğŸ‘€</a>
                    <form action="{{ url_for('delete_client', client_id=client.id) }}" 
                          method="POST" 
                          style="display: inline;"
                          onsubmit="return confirm('Are you sure you want to delete this client?');">
                        <button type="submit" class="btn btn-danger btn-sm">ğŸ—‘</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Mobile Card View -->
<div class="mobile-card-view">
    {% for client in clients %}
    <div class="mobile-card">
        <div class="mobile-card-header">#{{ loop.index }}</div>
        <div class="mobile-card-row mobile-grouped-row">
            <div class="mobile-half-col">
                <span class="mobile-card-label-sm">Name:</span>
                <span class="mobile-card-value-sm">{{ client.client_name }}</span>
            </div>
            <div class="mobile-half-col">
                <span class="mobile-card-label-sm">â˜</span>
                <span class="mobile-card-value-sm">
                    {% if client.phone_number %}
                    <a href="https://wa.me/{{ client.phone_number|replace(' ', '')|replace('-', '')|replace('+', '') }}" target="_blank" style="text-decoration: none; color: inherit;">{{ client.phone_number }}</a>
                    {% endif %}
                </span>
            </div>
        </div>
        <div class="mobile-card-row">
            <span class="mobile-card-label">Balance:</span>
            <span class="mobile-card-value"><strong style="font-size: 1.2em;">{{ (client.balance or 0)|comma2 }}</strong></span>
        </div>
        <div class="mobile-card-actions">
            <a href="{{ url_for('edit_client', client_id=client.id) }}" class="btn btn-secondary btn-sm">Edit</a>
            <button class="btn btn-success btn-sm" onclick="updateBalance('{{ client.id }}', 'credit')">Credit</button>
            <button class="btn btn-warning btn-sm" onclick="updateBalance('{{ client.id }}', 'debit')">Debit</button>
            <a href="{{ url_for('balance_history', client_id=client.id) }}" class="btn btn-info btn-sm">ğŸ—’ï¸</a>
            <a href="{{ url_for('client_transactions', client_id=client.id) }}" class="btn btn-primary btn-sm">ğŸ‘€</a>
            <form action="{{ url_for('delete_client', client_id=client.id) }}" 
                  method="POST" 
                  style="display: inline; flex: 1;"
                  onsubmit="return confirm('Are you sure you want to delete this client?');">
                <button type="submit" class="btn btn-danger btn-sm" style="width: 100%;">ğŸ—‘</button>
            </form>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<p class="empty-state">No clients yet. <a href="{{ url_for('add_client') }}">Add your first client</a></p>
{% endif %}

<script>
    function updateBalance(clientId, type) {
        const amount = prompt(`Enter amount to ${type}:`);
        if (amount) {
            window.location.href = `/clients/${clientId}/update_balance?amount=${amount}&type=${type}`;
        }
    }
</script>
{% endblock %}

