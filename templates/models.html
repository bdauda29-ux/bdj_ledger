{% extends "base.html" %}

{% block title %}Models - Ledger System{% endblock %}

{% block content %}
<div class="page-header">
    <h2>Models</h2>
    <a href="{{ url_for('add_model') }}" class="btn btn-primary">Create New Model</a>
</div>

{% if session.model_id %}
<div class="alert alert-success">Current model: {{ session.model_name }}</div>
{% endif %}

{% if models %}
<div class="table-container">
    <table class="data-table">
        <thead>
            <tr>
                <th>S.No</th>
                <th>Name</th>
                <th>Created At</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for m in models %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>
                    {% if edit_id == m.id %}
                        <form method="POST" action="{{ url_for('edit_model', model_id=m.id) }}" style="display:flex; gap:8px; align-items:center;">
                            <input type="text" name="name" value="{{ m.name }}" required>
                            <button type="submit" class="btn btn-primary btn-sm">Save</button>
                            <a href="{{ url_for('models') }}" class="btn btn-secondary btn-sm">Cancel</a>
                        </form>
                    {% else %}
                        {{ m.name }}
                    {% endif %}
                </td>
                <td>{{ m.created_at }}</td>
                <td>
                    <a class="btn btn-primary btn-sm" href="{{ url_for('select_model', model_id=m.id) }}">Select</a>
                    {% if session.permissions and session.permissions.is_admin %}
                    {% if edit_id != m.id %}
                    <a class="btn btn-secondary btn-sm" href="{{ url_for('models', edit_id=m.id) }}">Edit</a>
                    {% endif %}
                    <form action="{{ url_for('delete_model', model_id=m.id) }}" method="POST" style="display:inline;" onsubmit="return confirm('Delete model \"{{ m.name }}\" and all its data?');">
                        <button type="submit" class="btn btn-danger btn-sm">ðŸ—‘</button>
                    </form>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="mobile-card-view">
    {% for m in models %}
    <div class="mobile-card">
        {% if edit_id == m.id %}
            <form method="POST" action="{{ url_for('edit_model', model_id=m.id) }}">
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" name="name" value="{{ m.name }}" required style="width: 100%; padding: 8px; margin-bottom: 10px;">
                </div>
                <div style="display:flex; gap:10px;">
                    <button type="submit" class="btn btn-primary btn-sm" style="flex:1;">Save</button>
                    <a href="{{ url_for('models') }}" class="btn btn-secondary btn-sm" style="flex:1; text-align:center; display:flex; align-items:center; justify-content:center;">Cancel</a>
                </div>
            </form>
        {% else %}
            <div class="mobile-card-header">{{ m.name }}</div>
            <div class="mobile-card-row">
                <span class="mobile-card-label">Created At:</span>
                <span class="mobile-card-value">{{ m.created_at }}</span>
            </div>
            <div class="mobile-card-actions">
                <a class="btn btn-primary btn-sm" href="{{ url_for('select_model', model_id=m.id) }}">Select</a>
                {% if session.permissions and session.permissions.is_admin %}
                    <a class="btn btn-secondary btn-sm" href="{{ url_for('models', edit_id=m.id) }}">Edit</a>
                    <form action="{{ url_for('delete_model', model_id=m.id) }}" method="POST" onsubmit="return confirm('Delete model \"{{ m.name }}\" and all its data?');">
                        <button type="submit" class="btn btn-danger btn-sm" style="width:100%;">ðŸ—‘</button>
                    </form>
                {% endif %}
            </div>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% else %}
<p class="empty-state">No models yet. <a href="{{ url_for('add_model') }}">Create one</a></p>
{% endif %}
{% endblock %}
